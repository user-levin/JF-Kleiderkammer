import{u as N,r as u,j as e}from"./index-DLvFhXsc.js";import{u as w}from"./useQuery-Cnopp4RL.js";import{u as y}from"./useMutation-BXLqj6I4.js";import{a as x}from"./client-CSqpDYkL.js";const j=[{label:"Leser",value:"leser"},{label:"Verwalter",value:"verwalter"},{label:"Admin",value:"admin"}],f=new Intl.DateTimeFormat("de-DE",{dateStyle:"medium",timeStyle:"short"}),p={email:"",password:"",role:"leser",active:!0};function M(){var h;const v=N(),[t,n]=u.useState(p),[o,i]=u.useState(null),[c,l]=u.useState(null),r=w({queryKey:["users"],queryFn:async()=>(await x.get("/api/users")).data.data,staleTime:6e4}),d=y({mutationFn:async s=>(await x.post("/api/users",s)).data.data,onSuccess:()=>{n(p),i("Benutzer wurde angelegt."),l(null),v.invalidateQueries({queryKey:["users"]})},onError:s=>{const a=s instanceof Error?s.message:"Benutzer konnte nicht angelegt werden.";l(a),i(null)}}),g=s=>{s.preventDefault(),i(null),l(null);const a={email:t.email.trim().toLowerCase(),password:t.password.trim(),role:t.role,active:t.active};if(!a.email||!a.password){l("E-Mail und Passwort werden benötigt.");return}d.mutate(a)};return e.jsxs("div",{className:"users-layout",children:[e.jsxs("section",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Benutzer verwalten"}),e.jsx("p",{className:"muted",children:"Neue Benutzer hinzufügen und Rollen vergeben"})]})}),e.jsxs("form",{className:"user-form",onSubmit:g,children:[e.jsxs("div",{className:"user-form-grid",children:[e.jsxs("label",{children:["E-Mail*",e.jsx("input",{type:"email",value:t.email,onChange:s=>n(a=>({...a,email:s.target.value})),required:!0})]}),e.jsxs("label",{children:["Passwort*",e.jsx("input",{type:"password",value:t.password,onChange:s=>n(a=>({...a,password:s.target.value})),minLength:8,required:!0})]}),e.jsxs("label",{children:["Rolle*",e.jsx("select",{value:t.role,onChange:s=>n(a=>({...a,role:s.target.value})),required:!0,children:j.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("label",{className:"checkbox-inline",children:[e.jsx("input",{type:"checkbox",checked:t.active,onChange:s=>n(a=>({...a,active:s.target.checked}))}),e.jsx("span",{children:"Aktiv"})]})]}),e.jsx("div",{className:"user-form-actions",children:e.jsx("button",{type:"submit",disabled:d.isPending,children:d.isPending?"Speichere…":"Benutzer anlegen"})})]}),(o||c)&&e.jsx("p",{className:c?"error-text":"info-text",children:c??o})]}),e.jsxs("section",{className:"card user-list-card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{children:[e.jsx("h3",{children:"Vorhandene Benutzer"}),e.jsxs("p",{className:"muted",children:[((h=r.data)==null?void 0:h.length)??0," Nutzer registriert"]})]})}),r.isLoading?e.jsx("p",{className:"muted",children:"Benutzer werden geladen …"}):r.isError?e.jsx("p",{className:"error-text",children:"Benutzer konnten nicht geladen werden."}):r.data&&r.data.length>0?e.jsx("div",{className:"user-table-wrapper",children:e.jsxs("table",{className:"user-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"E-Mail"}),e.jsx("th",{children:"Rolle"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Erstellt"})]})}),e.jsx("tbody",{children:r.data.map(s=>{var m;const a=((m=j.find(b=>b.value===s.role))==null?void 0:m.label)??s.role;return e.jsxs("tr",{children:[e.jsx("td",{children:s.email}),e.jsx("td",{children:e.jsx("span",{className:"user-role-pill",children:a})}),e.jsx("td",{children:e.jsx("span",{className:s.active?"user-status active":"user-status inactive",children:s.active?"Aktiv":"Deaktiviert"})}),e.jsx("td",{children:f.format(new Date(s.createdAt))})]},s.id)})})]})}):e.jsx("p",{className:"muted",children:"Noch keine Benutzer vorhanden."})]})]})}export{M as default};
